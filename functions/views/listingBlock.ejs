<div class="grid-container">
  <div class="col col-8">
    <div class="listings-container" id="listings">
      <% for (var car in listings) { %>
        <a class="listing-item" href="<%= '/product/'+listings[car].id %>">

          <img
            src="https://images.unsplash.com/photo-1485291571150-772bcfc10da5?auto=format&fit=crop&q=80&w=2456&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="">
          <h2>
            <%= listings[car].model %>
          </h2>
          <li>
            <%= listings[car].make %>
          </li>
          <li>$<%= listings[car].price %>
          </li>
        </a>


        <% } %>
    </div>

  </div>
  <div class="col col-4">
    <div class="search-form">
      <button onClick="sortByYear()">Sort By Year</button>
      <form action="/searchCars" method="get">
        <label for="make">Car Make:</label>
        <select name="make" id="make">
          <option value="any">Any</option>
          <option value="Toyota">Toyota</option>
          <option value="Honda">Honda</option>
          <!-- Add more car makes here -->
        </select>

        <label for="model">Model:</label>
        <select name="model" id="model">
          <option value="any">Any</option>
          <option value="Camry">Camry</option>
          <option value="Civic">Civic</option>
          <!-- Add more car models here -->
        </select>

        <label for="price">Price Range:</label>
        <input type="range" name="minPrice" id="minPrice" min="0" max="3000000" step="10000" value="1000000">
        <input type="range" name="maxPrice" id="maxPrice" min="0" max="3000000" step="10000" value="2000000">
        <output for="minPrice" id="minPriceOutput">1,000,000</output> - <output for="maxPrice"
          id="maxPriceOutput">2,000,000</output>

        <label for="mileage">Mileage Range:</label>
        <input type="range" name="minMileage" id="minMileage" min="0" max="1000000" step="10000" value="10000">
        <input type="range" name="maxMileage" id="maxMileage" min="0" max="1000000" step="10000" value="20000">
        <output for="minMileage" id="minMileageOutput">10,000</output> - <output for="maxMileage"
          id="maxMileageOutput">20,000</output>

        <button type="submit">Search</button>
      </form>

      <script>
        const sortByYear = async () => {
          const response = await fetch("http://localhost:5001/api/year");
          const json = await response.json();
          var listingContainer = document.getElementById("listings");
          listingContainer.innerHTML = "";
          json.forEach((listing) => {
            var listingElement = document.createElement("a");
            listingElement.classList.add("listing-item");
            listingElement.href = "/product/" + listing.id;
            var img = document.createElement("img");
            img.src = "https://images.unsplash.com/photo-1485291571150-772bcfc10da5?auto=format&fit=crop&q=80&w=2456&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            var h2 = document.createElement("h2");
            h2.innerText = listing.model;
            var li1 = document.createElement("li");
            li1.innerText = listing.make;
            var li2 = document.createElement("li");
            li2.innerText = listing.price;
            listingElement.appendChild(img);
            listingElement.appendChild(h2);
            listingElement.appendChild(li1);
            listingElement.appendChild(li2);
            listingContainer.appendChild(listingElement);
          })
        }

        // JavaScript to update the output elements and synchronize sliders
        const updateOutput = (input, output) => {
          output.textContent = numberWithCommas(input.value);
        };

        const priceMinInput = document.getElementById("minPrice");
        const priceMaxInput = document.getElementById("maxPrice");
        const priceMinOutput = document.getElementById("minPriceOutput");
        const priceMaxOutput = document.getElementById("maxPriceOutput");

        priceMinInput.addEventListener("input", () => {
          updateOutput(priceMinInput, priceMinOutput);
          // Synchronize the maxPrice slider
          priceMaxInput.min = priceMinInput.value;
        });

        priceMaxInput.addEventListener("input", () => {
          updateOutput(priceMaxInput, priceMaxOutput);
          // Synchronize the minPrice slider
          priceMinInput.max = priceMaxInput.value;
        });

        const mileageMinInput = document.getElementById("minMileage");
        const mileageMaxInput = document.getElementById("maxMileage");
        const mileageMinOutput = document.getElementById("minMileageOutput");
        const mileageMaxOutput = document.getElementById("maxMileageOutput");

        mileageMinInput.addEventListener("input", () => {
          updateOutput(mileageMinInput, mileageMinOutput);
          // Synchronize the maxMileage slider
          mileageMaxInput.min = mileageMinInput.value;
        });

        mileageMaxInput.addEventListener("input", () => {
          updateOutput(mileageMaxInput, mileageMaxOutput);
          // Synchronize the minMileage slider
          mileageMinInput.max = mileageMaxInput.value;
        });

        // Function to add commas for better readability
        function numberWithCommas(x) {
          return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
      </script>
    </div>
  </div>